---
title: 浏览器安全
date: 2021-04-22 13:16:00
author: sec
---
# 同源策略
&emsp;&emsp;同源策略是一种约定，它是浏览器最核心也是最基本的安全功能，如果缺少了同源策略，浏览器就可能不正常工作。
&emsp;&emsp;同源策略限制了不同源的"document"或脚本，对当前的"document"读取或设置某些属性。
&emsp;&emsp;比如a.com的js在b.com上可以随意修改页面。为了避免这种事情发生就提出了"Origin（源）"的概念。
&emsp;&emsp;当js被浏览器认为来自不同源时，就会被拒绝。
&emsp;&emsp;影响源的因素有：Host，子域名，端口，协议 
&emsp;&emsp;浏览器中`<script>，<img>，<iframe>，<link>`等标签都可以跨域加载资源，不受同源策略限制，这些带src属性的标签每次加载时，都会向浏览器发起一次GET请求 。不同于XMLHttpRequest的是，通过Src属性加载的资源，浏览器限制了js的权限，使其不能读，写返回的内容。
&emsp;&emsp;但是XMLHttpRequest收到同源策略的影响，不能进行跨域请求。
&emsp;&emsp;如果XMLHttpRequest能跨域请求会造成一些敏感数据的泄露，比如CSRF的token。
&emsp;&emsp;`<script>`等标签可以跨域但是不能读写内容。绕过了同源策略，成为一个跨域漏洞。
# 浏览器沙箱
&emsp;&emsp;在网页中插入一段恶意代码，利用浏览器漏洞执行任意代码的攻击方式被称为"挂马"。
&emsp;&emsp;挂马的解决方式：
1. 浏览器密切结合DEP，ASLR，SafeSEH等操作系统提供的保护技术，对抗内存攻击。
2. 浏览器多进程架构，将浏览器各功能模块分开，当一个进程崩溃不会影响其他进程。
Google Chrome是第一个采用多进程框架的浏览器

&emsp;&emsp;渲染引擎由Sandbox隔离，网页代码与浏览器内核进程通信，与操作系统通信都需要通过IPC channel，在其中进行一些安全检查。
&emsp;&emsp;Sandbox就是沙箱，现在Sandbox成为"资源隔离类模块"的代名词。Sandbox的设计目的是为了：让不可信任的代码运行在一定的环境中，限制不可信任的代码访问隔离区之外的资源，如果要跨过Sacdbox边界产生数据交换，只能通过指定的数据通道。比如封装的API。这些API会检查请求的合法性。
&emsp;&emsp;Sandbox应用范围很广，提供hosting服务的共享主机环境，假设支持用户上传PHP，Python，Java等语言的代码，为了防止用户代码破坏环境，或者不同用户之间代码相互影响，应该设一个Sandbox对代码进行隔离。Sandbox需要考虑用户代码针对本地系统，内存，数据库，网络的可能请求，可以采用默认拒绝的策略，对于有需要的请求，可以通过封装API的方式进行。
&emsp;&emsp;对于浏览器来说，Sandbox技术无疑让不受信任的网页代码，JavaScript代码运行在一个受限制的空间，从而保护本地桌面系统的安全。
&emsp;&emsp;多进程架构最明显的一个好处是，多进程浏览器在发生崩溃时，只崩溃当前的Tab页，单进程浏览器会崩溃整个浏览器进程。
# 恶意网站拦截
&emsp;&emsp上面提到了"挂马"攻击方式能够破坏浏览器安全。"挂马"在浏览器中执行的时候会通过`<scirpt>或者<iframe>`标签加载一个恶意的网站。除了加载的恶意网站外，钓鱼网站，诈骗网站也是恶意的网址。为了保护用户的安全，现在大部分浏览器都推出了自己的拦截网址的功能。通过最新获取的黑名单来警告用户访问恶意网站。
